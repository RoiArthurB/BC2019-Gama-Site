<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Corridor Multi-Level Architecture with Mathematics Model and Agent Based Model · GAMA-Platform</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="GAMA"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Corridor Multi-Level Architecture with Mathematics Model and Agent Based Model · GAMA-Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://roiarthurb.github.io/BC2019-Gama-Site/"/><meta property="og:description" content="GAMA"/><meta property="og:image" content="https://roiarthurb.github.io/BC2019-Gama-Site//resources/images/general/GamaPlatform.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://roiarthurb.github.io/BC2019-Gama-Site//resources/images/general/GamaPlatform.png"/><link rel="shortcut icon" href="/BC2019-Gama-Site//img/gama-logo.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="stylesheet" href="/BC2019-Gama-Site/css/code-block-buttons.css"/><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"/><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.4.4/fuse.min.js"></script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/BC2019-Gama-Site/js/code-block-buttons.js"></script><script type="text/javascript" src="/BC2019-Gama-Site/js/searchEngine.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><link rel="stylesheet" href="/BC2019-Gama-Site/css/main.css"/><script src="/BC2019-Gama-Site/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/BC2019-Gama-Site/"><img class="logo" src="/BC2019-Gama-Site//img/gama-logo_white.png" alt="GAMA-Platform"/><h2 class="headerTitleWithLogo">GAMA-Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/BC2019-Gama-Site/wiki/Home" target="_self">Documentation</a></li><li class=""><a href="/BC2019-Gama-Site/wiki/Tutorials" target="_self">Tutorials</a></li><li class=""><a href="/BC2019-Gama-Site/help" target="_self">Download</a></li><li class=""><a href="/BC2019-Gama-Site/wiki/Contribute" target="_self">Contribute</a></li><li class=""><a target="_self"></a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Corridor Multi-Level Architecture with Mathematics Model and Agent Based Model</h1></header><article><div><span><p>_Author : _</p>
<p>This model shows how to use multi-level architecture. Two corridors are presented : one which can capture the pedestrians going through it and computing for them the time before releasing them at the end of the corridor, and an other doing nothing, letting the pedestrians moving by themselves in the corridor.</p>
<p>Code of the model :</p>
<pre><code class="hljs">
model pedestrian_corridor_Hybrid_vs_ABM

global 
{
    
    <span class="hljs-comment">//Parameters of the environment</span>
    int environment_width &lt;- 200 const: true;
    int environment_height &lt;- 200 const: true;
    geometry shape &lt;- rectangle(environment_width, environment_height); 
    
    
    <span class="hljs-comment">//Parameters of the pedestrian agents</span>
    rgb pedestrian_green &lt;- #green;
    
    float pedestrian_size &lt;- 1.0;
    geometry pedestrian_shape &lt;- circle (pedestrian_size) ;
    float pedestrian_speed &lt;- 2.0;
 
    <span class="hljs-comment">//Parameters of the corridors</span>
    rgb corridor_color &lt;- rgb (<span class="hljs-string">'blue'</span>);
    int corridor_width &lt;- 160 depends_on: [environment_width];
    int corridor_height &lt;- (int(environment_height * 0.05));

    point corridor_location_0 &lt;- {environment_width / 2, environment_height / 4};
    geometry corridor_shape_0 &lt;- ( (rectangle ({corridor_width, corridor_height})) at_location corridor_location_0) ;

    point corridor_location_1 &lt;- {environment_width / 2, environment_height * 0.75};
    geometry corridor_shape_1 &lt;- ( (rectangle ({corridor_width, corridor_height})) at_location corridor_location_1) ;

    <span class="hljs-comment">//Parameters of pedestrian generation</span>
    int new_pedestian_generate_frequency &lt;- 8;
    point pedestrian_source_0 &lt;- {0, corridor_location_0.y} ;
    point pedestrian_source_1 &lt;- {0, corridor_location_1.y} ;
     
     
     
    init 
    {
        create corridor number: 2 returns: new_corridors;
        
        ask (new_corridors at 0) 
        {
            do init_corridor corridor_shape: corridor_shape_0 is_hybrid: false;
        }

        ask (new_corridors at 1) 
        {
            do init_corridor corridor_shape: corridor_shape_1 is_hybrid: true; 
        }
    }

    <span class="hljs-comment">//Generation of pedestrians according to the frequency of generation : one for each corridor</span>
    reflex generate_pedestrians when: ( (cycle mod new_pedestian_generate_frequency) = 0 ) 
    { 
        create pedestrian number: 2 returns: new_pedestrians;
        
        ask (new_pedestrians at 0) 
        {
            do init_location loc: pedestrian_source_0;
        }
        
        ask (new_pedestrians at 1) 
        {
            do init_location loc: pedestrian_source_1;
        }
    }   
}


<span class="hljs-comment">//Species for the pedestrians which can move</span>
species pedestrian skills: [moving] {
    geometry shape &lt;- circle(pedestrian_size);
    rgb color;
    corridor last_corridor;
    point target_location;
    float speed &lt;- pedestrian_speed;
    
    <span class="hljs-comment">//Initialisation of the target location according to its generation location</span>
    action init_location (point loc) {
        location &lt;- loc;
        target_location &lt;- {environment_width, location.y};
        heading &lt;- self towards (target_location);
    }

    <span class="hljs-comment">//Reflex to move the agent to its target location and make it die once it reached its target</span>
    reflex move_left 
    {
        do move heading: (self) towards (target_location); 
        
        if ( (target_location.x - location.x) &lt;= speed ) 
        {
            do die;
        }
    }
     
    aspect default 
    {
        draw shape color: color;
    }
}

<span class="hljs-comment">//Species for the corridor which can capture pedestrians</span>
species corridor  {
    bool capture_pedestrians;
    
    
    action init_corridor (geometry corridor_shape, bool is_hybrid) 
    {
        shape &lt;- corridor_shape;
        capture_pedestrians &lt;- is_hybrid;
    }

    float max_speed &lt;- pedestrian_speed;
    float macro_length min: 0.0 &lt;- float(corridor_width); <span class="hljs-comment">// the length of macro_patch</span>
    
    <span class="hljs-comment">//Species to model the pedestrian captured by the corridor</span>
    species captured_pedestrian parent: pedestrian schedules: [] 
    {
        float released_time;  
        
        aspect default { }
    }
    
    init 
    { 
        create corridor_info_drawer number: 1 with: [target :: self];
    }
    <span class="hljs-comment">//Reflex to capture the pedestrians overlapping the corridor ie entering the corridor </span>
    reflex aggregate when: capture_pedestrians 
    {
        list&lt;pedestrian&gt; tobe_captured_pedestrians &lt;- (pedestrian overlapping shape) where ( (each.last_corridor != self) and ((each.location).x &lt; (self.location).x) ) ; 
        
        if !(empty (tobe_captured_pedestrians)) 
        {
            capture tobe_captured_pedestrians as: captured_pedestrian returns: cps { 
                last_corridor &lt;- myself;
            }
            if !(empty (cps)) 
            {
                    <span class="hljs-comment">//Computation of the time when the pedestrians captured will be released according to the speed</span>
                    <span class="hljs-comment">// and the time they should make to pass the corridor if they move by themselves</span>
                    float group_outgoing_time &lt;- time + (corridor_width / (pedestrian_speed) ); 
                    loop cp over: cps 
                    {
                            cp.released_time &lt;- group_outgoing_time;
                    }
            }
        
        }
    }
    
    <span class="hljs-comment">//Reflex to release the pedestrians when we consider they were enough time inside the corridor </span>
    reflex disaggregate  
    {
        list tobe_released_pedestrians &lt;- members where (time &gt;= (captured_pedestrian (each)).released_time);
        
        if !(empty (tobe_released_pedestrians)) 
        {
            
            release tobe_released_pedestrians as: pedestrian in: world returns: released_pedestrians;
            
            loop rp over: released_pedestrians 
            {
                rp.speed &lt;- pedestrian_speed;
                rp.location &lt;- {((environment_width / 2) + (corridor_width / 2)), ((corridor_shape_1).location).y};
            }
        }
    }
        
    aspect default 
    {
        draw shape color: corridor_color;
    }
}
 
species corridor_info_drawer 
{
    corridor target;
    
    aspect base 
    {
        if target.capture_pedestrians 
        {
            draw <span class="hljs-string">'Hybrid model (coupling: ABM and Mathematical Model)'</span> color: #blue size: 7 at: {(target.location).x - 90, (target.location).y - 10};
            draw  <span class="hljs-string">'Aggregated agents: '</span> + string(length(target.members)) color: #black size: 7 at: {(target.location).x - 30, (target.location).y + 2};
        } 
        else 
        {
            draw <span class="hljs-string">'Agent-Based Model (ABM)'</span> color: #blue size: 7 at: {(target.location).x - 40, (target.location).y - 10};
        }
    }
}

experiment default_experiment type: gui 
{
    output 
    {
        display default_display 
        {
            species pedestrian;
            species corridor transparency: 0.8;
            species corridor_info_drawer aspect: base;
        }
    }
}
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/BC2019-Gama-Site/" class="nav-home"><img src="/BC2019-Gama-Site//img/gama-logo.png" alt="GAMA-Platform" width="66" height="58"/></a><div><h5>Networks</h5><a href="https://www.youtube.com/channel/UCWJ1kWGDDI-9u2f2uD0gcaQ" target="_blank"><i class="fab fa-youtube"></i> Youtube</a><a href="https://www.linkedin.com/company/gama-platform" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a><a href="https://twitter.com/gamaplatform" target="_blank"><i class="fab fa-twitter"></i> Twitter</a><a href="https://www.facebook.com/GamaPlatform/" target="_blank"><i class="fab fa-facebook"></i> Facebook</a></div><div><h5>Mailing list</h5><a href="https://groups.google.com/forum/#!forum/gama-platform" target="_blank"><i class="fas fa-envelope"></i> For Users<br/>gama-platform@googlegroups.com</a><a href="https://groups.google.com/forum/#!forum/gama-dev" target="_blank"><i class="fas fa-envelope"></i> For Developers<br/>gama-dev@googlegroups.com</a></div><div><h5>Ecosystem</h5><a href="https://github.com/gama-platform/gama"><i class="fab fa-github"></i> GitHub Gama</a><a href="https://github.com/gama-platform/gama.experimental"><i class="fas fa-puzzle-piece"></i> Gama Experimental Plugins</a><a href="https://github.com/gama-platform/gama.models.experimental"><i class="fas fa-scroll"></i> Gama Experimental Models</a></div></section><section class="copyright">Copyright © 2019 GAMA-Platform</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '0f9f28b9ab9efae89810921a351753b5',
                indexName: 'github',
                inputSelector: '#search_input_react'
              });
            </script></body></html>