<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Diffusion Statement Kernel matrix generation · GAMA-Platform</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="GAMA, modeling made easy"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Diffusion Statement Kernel matrix generation · GAMA-Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://roiarthurb.github.io/BC2019-Gama-Site/"/><meta property="og:description" content="GAMA, modeling made easy"/><meta property="og:image" content="https://roiarthurb.github.io/BC2019-Gama-Site/resources/images/general/GamaPlatform.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://roiarthurb.github.io/BC2019-Gama-Site/resources/images/general/GamaPlatform.png"/><link rel="shortcut icon" href="/BC2019-Gama-Site/resources/images/general/GamaPlatform.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://roiarthurb.github.io/BC2019-Gama-Site/blog/atom.xml" title="GAMA-Platform Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://roiarthurb.github.io/BC2019-Gama-Site/blog/feed.xml" title="GAMA-Platform Blog RSS Feed"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js" async=""></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js" async=""></script><script type="text/javascript" src="/BC2019-Gama-Site/js/code-block-buttons.js" async=""></script><link rel="stylesheet" href="/BC2019-Gama-Site/css/main.css"/><script src="/BC2019-Gama-Site/js/codetabs.js"></script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/BC2019-Gama-Site/"><img class="logo" src="/BC2019-Gama-Site/resources/images/general/GamaPlatform.png" alt="GAMA-Platform"/><h2 class="headerTitleWithLogo">GAMA-Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/BC2019-Gama-Site/docs/Home" target="_self">Docs</a></li><li class=""><a href="/BC2019-Gama-Site/help" target="_self">Help</a></li><li class=""><a href="/BC2019-Gama-Site/blog/" target="_self">Blog</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Diffusion Statement Kernel matrix generation</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="generate-diffusion-matrix-with-parameters"></a><a href="#generate-diffusion-matrix-with-parameters" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generate diffusion matrix with parameters</h1>
<p><em>Author : Julien Mazars</em></p>
<p>This model shows how to create a diffusion matrix by using the 4 parameters variation, proportion, radius and min-value. Manipulate the parameters to see in real time the result. The number displayed in each cells are the ratio of the initial signal diffused at the end of a step.</p>
<p><img src="gm_wiki/resources/images/modelLibraryScreenshots/Additionnal Plugins/Diffusion Statement/Diffusion Statement Kernel matrix generation/my_display-10.png" alt="Eclipse folder." title class="img-responsive"> == $0</p>Code of the model : 
<pre><code class="hljs">
model kernelmatrixgeneration

global {
    // parameters
    float variation &lt;- 0.0;
    float proportion &lt;- 1.0;
    int radius &lt;- 1;
    float min_value &lt;- 0.0;
    int cycle_length &lt;- 1;
    
    // global variables
    int cell_max_size &lt;- 51;
    int x_min &lt;- cell_max_size;
    int x_max &lt;- 0;
    int y_min &lt;- cell_max_size;
    int y_max &lt;- 0;
    
    float world_size &lt;- 100.0;
    geometry shape &lt;- cube(world_size);
    
    buffer_cells selected_cells;
    
    // init the emiter cell as the one in the center of the world.
    init {
        selected_cells &lt;- location as buffer_cells;
        // no need to have a faster display. Let's cool down your computer a bit ;)
        minimum_cycle_duration &lt;- 200#ms;
    }
    
    reflex update {
        x_min &lt;- cell_max_size;
        x_max &lt;- 0;
        y_min &lt;- cell_max_size;
        y_max &lt;- 0;
        // copy the values of the buffer_cells (of the previous step) to the grid which will be displayed.
        ask cells {
            value &lt;- (location as buffer_cells).value;
        }
        ask buffer_cells {
            // find the boundaries of the diffusion
            if (value != 0.0) {
                if (grid_x &gt; x_max) {
                    x_max &lt;- grid_x;
                }
                if (grid_x &lt; x_min) {
                    x_min &lt;- grid_x;
                }
                if (grid_y &gt; y_max) {
                    y_max &lt;- grid_y;
                }
                if (grid_y &lt; y_min) {
                    y_min &lt;- grid_y;
                }
            }
        }
        // re-initialize the value of the buffer grid to 0, and the value of the central cell to 1.
        ask buffer_cells {
            value &lt;- 0.0;
            if (self = selected_cells) {
                value &lt;- 1.0;
            }
        }
        // diffuse the value over the buffer grid, according to the parameters choosen.
        diffuse var:value on:buffer_cells variation:variation proportion:proportion radius:radius cycle_length:cycle_length min_value:min_value;
    }
}

// the buffer grid will be used to compute the diffusion at each step.
grid buffer_cells height:cell_max_size width:cell_max_size {
    // the diffused variable
    float value &lt;- 0.0;
}

// this grid is the copy of the buffer grid at the end of each step. Indeed, we have to display the grid once the diffusion has been done.
grid cells height:cell_max_size width:cell_max_size {
    // the diffused variable
    float value &lt;- 0.0;
    
    aspect base {
        // we only display the cells wich contains a non null value
        if (grid_x &lt;= x_max and grid_x &gt;= x_min and grid_y &lt;= y_max and grid_y &gt;= y_min)
        {
            // compute dynamically the size of the current cell.
            float size_cell &lt;- world_size/(x_max-x_min+1);
            // compute dynamically the position of the current cell.
            point pos &lt;- {(grid_x-x_min+1)*size_cell-0.5*size_cell,(grid_y-y_min+1)*size_cell-0.5*size_cell};
            // display each cell as a square. The color is linked to the value of the diffused variable.
            draw square(size_cell) color:hsb(value,1.0,1.0) border:#black at:pos;
            // display the ratio in each square.
            draw string(value) at: pos + {-size_cell/3,0} color: °black font: font("Helvetica", size_cell * #zoom * 2/3, #bold) perspective:true;
        }
    }
}

experiment my_experiment type:gui {
    parameter "proportion" var:proportion;
    parameter "variation" var:variation;
    parameter "min_value" var:min_value;
    parameter "radius" var:radius;
    parameter "cycle_length" var:cycle_length;
    output {
        display my_display {
            species cells aspect:base;
        }
    }
}
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/BC2019-Gama-Site/" class="nav-home"><img src="/BC2019-Gama-Site/resources/images/general/GamaPlatform.png" alt="GAMA-Platform" width="66" height="58"/></a><div><h5>Docs</h5><a href="/BC2019-Gama-Site/docs/en/doc1.html">Getting Started (or other categories)</a><a href="/BC2019-Gama-Site/docs/en/doc2.html">Guides (or other categories)</a><a href="/BC2019-Gama-Site/docs/en/doc3.html">API Reference (or other categories)</a></div><div><h5>Community</h5><a href="/BC2019-Gama-Site/en/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://discordapp.com/">Project Chat</a><a href="https://twitter.com/" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/BC2019-Gama-Site/blog">Blog</a><a href="https://github.com/">GitHub</a></div></section><section class="copyright">Copyright © 2019 GAMA-Platform</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '0f9f28b9ab9efae89810921a351753b5',
                indexName: 'github',
                inputSelector: '#search_input_react'
              });
            </script></body></html>