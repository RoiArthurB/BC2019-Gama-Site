<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>References/ModelLibrary/Toy Models/Co-model Example/Co-model Example Comodel_SIR_Switch · Test Site</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="A website for testing"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="References/ModelLibrary/Toy Models/Co-model Example/Co-model Example Comodel_SIR_Switch · Test Site"/><meta property="og:type" content="website"/><meta property="og:url" content="https://roiarthurb.github.io/BC2019-Gama-Site/"/><meta property="og:description" content="A website for testing"/><meta property="og:image" content="https://roiarthurb.github.io/BC2019-Gama-Site/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://roiarthurb.github.io/BC2019-Gama-Site/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/BC2019-Gama-Site/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://roiarthurb.github.io/BC2019-Gama-Site/blog/atom.xml" title="Test Site Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://roiarthurb.github.io/BC2019-Gama-Site/blog/feed.xml" title="Test Site Blog RSS Feed"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><link rel="stylesheet" href="/BC2019-Gama-Site/css/main.css"/><script src="/BC2019-Gama-Site/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/BC2019-Gama-Site/"><img class="logo" src="/BC2019-Gama-Site/img/favicon.ico" alt="Test Site"/><h2 class="headerTitleWithLogo">Test Site</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/BC2019-Gama-Site/docs/doc1" target="_self">Docs</a></li><li class=""><a href="/BC2019-Gama-Site/help" target="_self">Help</a></li><li class=""><a href="/BC2019-Gama-Site/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">References/ModelLibrary/Toy Models/Co-model Example/Co-model Example Comodel_SIR_Switch</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="comodel-sir-switch"></a><a href="#comodel-sir-switch" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Comodel SIR Switch</h1>
<p><em>Author : HUYNH Quang Nghi</em></p>
<p>This is a comodel that implement the dynamic of SIR_switch: it will use the EBM when the density of population is big and ABM when the density of population is low. It demonstrate the capability of using dynamically the legacy models.
SIR_ABM_coupling is the coupling that manipulates the elements inside SIR_ABM model and proposes the function would be used from outside. SIR_ABM is a simple example of SIR that use the agents to represent the spreading of disease..
SIR_EBM_coupling is the coupling that manipulates the elements inside SIR_EBM model and proposes the function would be used from outside. SIR_EBM is a simple example of ODE use into agents with the example of the SIR equation system.</p>
<p>Imported models :</p>
<pre><code class="hljs">model SIR_ABM 

global{
    geometry shape&lt;-envelope(square(<span class="hljs-number">100</span>));
    <span class="hljs-built_in">float</span> beta &lt;- <span class="hljs-number">0.5</span> ;      
    <span class="hljs-built_in">float</span> nu &lt;- <span class="hljs-number">0.001</span> ;
    <span class="hljs-built_in">float</span> delta &lt;- <span class="hljs-number">0.01</span>;
    init{
        create Host number:<span class="hljs-number">495</span> ;
        create Host number:<span class="hljs-number">5</span>{state&lt;<span class="hljs-number">-1</span>;}
        
    }
}

species Host skills:[moving]{
    <span class="hljs-built_in">int</span> state&lt;<span class="hljs-number">-0</span>;
    list&lt;rgb&gt; color&lt;-[#green, #red, #yellow];
    <span class="hljs-built_in">ref</span>lex moving{
        <span class="hljs-keyword">do</span> wander;
    }


    
    <span class="hljs-built_in">ref</span>lex become_infected when: state=<span class="hljs-number">1</span> {
        list n&lt;- self neighbors_at(<span class="hljs-number">1</span>);
        ask n{          
            <span class="hljs-keyword">if</span> (flip(beta)) {
                state&lt;<span class="hljs-number">-1</span>;    
            }
        }
    }
    
    <span class="hljs-built_in">ref</span>lex become_immune when: (state=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> flip(delta)) {
        state&lt;<span class="hljs-number">-2</span>;
    }
    
            
    aspect base{
        draw circle(<span class="hljs-number">1</span>) color: color[state];
    }
}
experiment SIR_ABM_exp type:gui{
    output {
        display gridDisp{
            species Host aspect:base;
        }
    }
}
</code></pre>
<pre><code class="hljs">model SIR_ABM_coupling

<span class="hljs-keyword">import</span> "SIR_ABM.gaml"
experiment SIR_ABM_coupling_exp <span class="hljs-keyword">type</span>: gui parent: SIR_ABM_exp
{
    <span class="hljs-type">int</span> get_num_S
    {
        <span class="hljs-keyword">return</span> length(Host <span class="hljs-keyword">where</span> (<span class="hljs-keyword">each</span>.state = <span class="hljs-number">0</span>));
    }

    <span class="hljs-type">int</span> get_num_I
    {
        <span class="hljs-keyword">return</span> length(Host <span class="hljs-keyword">where</span> (<span class="hljs-keyword">each</span>.state = <span class="hljs-number">1</span>));
    }

    <span class="hljs-type">int</span> get_num_R
    {
        <span class="hljs-keyword">return</span> length(Host <span class="hljs-keyword">where</span> (<span class="hljs-keyword">each</span>.state = <span class="hljs-number">2</span>));
    }

    action set_num_S_I_R (<span class="hljs-type">int</span> numS, <span class="hljs-type">int</span> numI, <span class="hljs-type">int</span> numR)
    {
        <span class="hljs-type">unknown</span> <span class="hljs-keyword">call</span>;
        <span class="hljs-keyword">call</span> &lt;- set_num_S(numS);
        <span class="hljs-keyword">call</span> &lt;- set_num_I(numI);
        <span class="hljs-keyword">call</span> &lt;- set_num_R(numR);
    }

    action set_num_S (<span class="hljs-type">int</span> num)
    {
        ask (Host <span class="hljs-keyword">where</span> (<span class="hljs-keyword">each</span>.state = <span class="hljs-number">0</span>))
        {
            <span class="hljs-keyword">do</span> die;
        }

        <span class="hljs-keyword">create</span> Host number: num
        {
            state &lt;- <span class="hljs-number">0</span>;
        }

    }

    action set_num_I (<span class="hljs-type">int</span> num)
    {
        ask (Host <span class="hljs-keyword">where</span> (<span class="hljs-keyword">each</span>.state = <span class="hljs-number">1</span>))
        {
            <span class="hljs-keyword">do</span> die;
        }

        <span class="hljs-keyword">create</span> Host number: num
        {
            state &lt;- <span class="hljs-number">1</span>;
        }

    }

    action set_num_R (<span class="hljs-type">int</span> num)
    {
        ask (Host <span class="hljs-keyword">where</span> (<span class="hljs-keyword">each</span>.state = <span class="hljs-number">2</span>))
        {
            <span class="hljs-keyword">do</span> die;
        }

        <span class="hljs-keyword">create</span> Host number: num
        {
            state &lt;- <span class="hljs-number">2</span>;
        }

    }

    output
    {
    }

}
</code></pre>
<pre><code class="hljs">model SIR_EBM

global {
    init{
        create agent_with_SIR_dynamic;
    } 
}


species agent_with_SIR_dynamic {
    int N &lt;- <span class="hljs-number">495</span> ;
    int iInit &lt;- <span class="hljs-number">5</span>;     

    <span class="hljs-built_in">float</span> t;  
    <span class="hljs-built_in">float</span> S &lt;- N - <span class="hljs-built_in">float</span>(iInit);          
    <span class="hljs-built_in">float</span> I &lt;- <span class="hljs-built_in">float</span>(iInit); 
    <span class="hljs-built_in">float</span> R &lt;- <span class="hljs-number">0.0</span>; 
    
    <span class="hljs-built_in">float</span> alpha &lt;- <span class="hljs-number">0.2</span>;
    <span class="hljs-built_in">float</span> <span class="hljs-built_in">beta</span> &lt;- <span class="hljs-number">0.8</span>; 

    <span class="hljs-built_in">float</span> h &lt;- <span class="hljs-number">0.01</span>;
   
    equation SIR{ 
        <span class="hljs-built_in">diff</span>(S,t) = (- <span class="hljs-built_in">beta</span> *   S * I / N);
        <span class="hljs-built_in">diff</span>(I,t) = (  <span class="hljs-built_in">beta</span>*  S * I / N) - (alpha * I)  ;
        <span class="hljs-built_in">diff</span>(R,t) = (  alpha  *  I) ;
    }
                
    reflex solving {
//      write S;
        <span class="hljs-built_in">solve</span> SIR <span class="hljs-built_in">method</span>: <span class="hljs-string">"rk4"</span> <span class="hljs-keyword">step</span>: h;// cycle_length: <span class="hljs-number">1</span>/h ;
    }    
}


experiment SIR_EBM_exp type: gui {
    output { 
        <span class="hljs-built_in">display</span> display_charts {
            chart <span class="hljs-string">"SIR_agent"</span> type: series <span class="hljs-built_in">background</span>: #white {
                data 'S' value: <span class="hljs-built_in">first</span>(list(agent_with_SIR_dynamic)).S <span class="hljs-built_in">color</span>: #green ;               
                data 'I' value: <span class="hljs-built_in">first</span>(list(agent_with_SIR_dynamic)).I <span class="hljs-built_in">color</span>: #red ;
                data 'R' value: <span class="hljs-built_in">first</span>(list(agent_with_SIR_dynamic)).R <span class="hljs-built_in">color</span>: #blue ;
            }
        }
    }
}
</code></pre>
<pre><code class="hljs">model SIR_EBM_coupling

<span class="hljs-keyword">import</span> <span class="hljs-string">"SIR_EBM.gaml"</span>
experiment SIR_EBM_coupling_exp <span class="hljs-keyword">type</span>: gui parent: SIR_EBM_exp
{
    <span class="hljs-built_in">int</span> get_num_S
    {
        <span class="hljs-keyword">return</span> first(agent_with_SIR_dynamic).S;
    }

    <span class="hljs-built_in">int</span> get_num_I
    {
        <span class="hljs-keyword">return</span> first(agent_with_SIR_dynamic).I;
    }

    <span class="hljs-built_in">int</span> get_num_R
    {
        <span class="hljs-keyword">return</span> first(agent_with_SIR_dynamic).R;
    }

    <span class="hljs-keyword">action</span> set_num_S_I_R (<span class="hljs-built_in">int</span> numS, <span class="hljs-built_in">int</span> numI, <span class="hljs-built_in">int</span> numR)
    {
        unknown <span class="hljs-keyword">call</span>;
        <span class="hljs-keyword">call</span> &lt;- set_num_S(numS);
        <span class="hljs-keyword">call</span> &lt;- set_num_I(numI);
        <span class="hljs-keyword">call</span> &lt;- set_num_R(numR);
    }

    <span class="hljs-keyword">action</span> set_num_S (<span class="hljs-built_in">int</span> num)
    {
        first(agent_with_SIR_dynamic).S &lt;- <span class="hljs-built_in">float</span>(num);
    }

    <span class="hljs-keyword">action</span> set_num_I (<span class="hljs-built_in">int</span> num)
    {
        first(agent_with_SIR_dynamic).I &lt;- <span class="hljs-built_in">float</span>(num);
    }

    <span class="hljs-keyword">action</span> set_num_R (<span class="hljs-built_in">int</span> num)
    {
        first(agent_with_SIR_dynamic).R &lt;- <span class="hljs-built_in">float</span>(num);
    }

    output
    {
    }

}
</code></pre>
<p>Code of the model :</p>
<pre><code class="hljs">model Comodel_SIR_Switch

<span class="hljs-keyword">import</span> "Legacy_models/SIR_EBM_coupling.gaml" <span class="hljs-keyword">as</span> SIR_1
<span class="hljs-keyword">import</span> "Legacy_models/SIR_ABM_coupling.gaml" <span class="hljs-keyword">as</span> SIR_2


<span class="hljs-keyword">global</span>
{
    geometry shape &lt;- envelope(square(<span class="hljs-number">100</span>));
    <span class="hljs-type">int</span> switch_threshold &lt;- <span class="hljs-number">120</span>; // threshold <span class="hljs-keyword">for</span> switching models
    <span class="hljs-type">int</span> threshold_to_IBM &lt;- <span class="hljs-number">220</span>; // threshold under which the model swith <span class="hljs-keyword">to</span> IBM
    <span class="hljs-type">int</span> threshold_to_Maths &lt;- <span class="hljs-number">20</span>;
    init
    {
        <span class="hljs-keyword">create</span> SIR_1.SIR_EBM_coupling_exp;
        <span class="hljs-keyword">create</span> SIR_2.SIR_ABM_coupling_exp;
        <span class="hljs-keyword">create</span> Switch;
    }

}

species Switch
{
    <span class="hljs-type">int</span> S &lt;- <span class="hljs-number">495</span>;
    <span class="hljs-type">int</span> I &lt;- <span class="hljs-number">5</span>;
    <span class="hljs-type">int</span> R &lt;- <span class="hljs-number">0</span>;
    reflex request_from_micro_model
    {
        //<span class="hljs-keyword">if</span> the size <span class="hljs-keyword">of</span> S population <span class="hljs-keyword">and</span> I population are bigger than a threshold, use the EBM
        <span class="hljs-keyword">if</span> (S &gt; threshold_to_Maths <span class="hljs-keyword">and</span> I &gt; threshold_to_Maths)
        {
            ask world
            {
                <span class="hljs-type">unknown</span> <span class="hljs-keyword">call</span>;
                <span class="hljs-keyword">call</span> &lt;- first(SIR_1.SIR_EBM_coupling_exp).set_num_S_I_R(myself.S, myself.I, myself.R);
                ask first(SIR_1.SIR_EBM_coupling_exp).simulation
                {
                    <span class="hljs-keyword">loop</span> times: <span class="hljs-number">5</span>
                    {
                        <span class="hljs-keyword">do</span> _step_;
                    }

                }

                myself.S &lt;- first(SIR_1.SIR_EBM_coupling_exp).get_num_S();
                myself.I &lt;- first(SIR_1.SIR_EBM_coupling_exp).get_num_I();
                myself.R &lt;- first(SIR_1.SIR_EBM_coupling_exp).get_num_R();
            }

        }
        
        //<span class="hljs-keyword">if</span> the size <span class="hljs-keyword">of</span> S population <span class="hljs-keyword">or</span>  I population are smaller  than a threshold, use the ABM
        <span class="hljs-keyword">if</span> (I &lt; threshold_to_IBM <span class="hljs-keyword">or</span> S &lt; threshold_to_IBM)
        {
            ask world
            {
                <span class="hljs-type">unknown</span> <span class="hljs-keyword">call</span>;
                <span class="hljs-keyword">call</span> &lt;- first(SIR_2.SIR_ABM_coupling_exp).set_num_S_I_R(myself.S, myself.I, myself.R);
                ask first(SIR_2.SIR_ABM_coupling_exp).simulation
                {
                    <span class="hljs-keyword">loop</span> times: <span class="hljs-number">1</span>
                    {
                        <span class="hljs-keyword">do</span> _step_;
                    }

                }

                myself.S &lt;- first(SIR_2.SIR_ABM_coupling_exp).get_num_S();
                myself.I &lt;- first(SIR_2.SIR_ABM_coupling_exp).get_num_I();
                myself.R &lt;- first(SIR_2.SIR_ABM_coupling_exp).get_num_R();
            }

        }

    }

    aspect base
    {
        draw square(<span class="hljs-number">100</span>);
    }

}

experiment Simple_exp <span class="hljs-keyword">type</span>: gui
{
    output
    {
        display co_SIR_chart
        {
            chart "SIR_agent" <span class="hljs-keyword">type</span>: series background: # white
            {
                data <span class="hljs-string">'S'</span> <span class="hljs-keyword">value</span>: first(Switch).S color: # green;
                data <span class="hljs-string">'I'</span> <span class="hljs-keyword">value</span>: first(Switch).I color: # red;
                data <span class="hljs-string">'R'</span> <span class="hljs-keyword">value</span>: first(Switch).R color: # yellow;
            }

        }

    }

}
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/BC2019-Gama-Site/" class="nav-home"><img src="/BC2019-Gama-Site/img/favicon.ico" alt="Test Site" width="66" height="58"/></a><div><h5>Docs</h5><a href="/BC2019-Gama-Site/docs/en/doc1.html">Getting Started (or other categories)</a><a href="/BC2019-Gama-Site/docs/en/doc2.html">Guides (or other categories)</a><a href="/BC2019-Gama-Site/docs/en/doc3.html">API Reference (or other categories)</a></div><div><h5>Community</h5><a href="/BC2019-Gama-Site/en/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://discordapp.com/">Project Chat</a><a href="https://twitter.com/" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/BC2019-Gama-Site/blog">Blog</a><a href="https://github.com/">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/BC2019-Gama-Site/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2019 GAMA-Platform</section></footer></div></body></html>