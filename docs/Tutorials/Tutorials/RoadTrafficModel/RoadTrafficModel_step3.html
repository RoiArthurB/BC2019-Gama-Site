<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Tutorials/Tutorials/RoadTrafficModel/RoadTrafficModel_step3 · Test Site</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;h1&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;3-movement-of-people&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#3-movement-of-people&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. Movement of People&lt;/h1&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Tutorials/Tutorials/RoadTrafficModel/RoadTrafficModel_step3 · Test Site"/><meta property="og:type" content="website"/><meta property="og:url" content="https://roiarthurb.github.io/BC2019-Gama-Site/"/><meta property="og:description" content="&lt;h1&gt;&lt;a class=&quot;anchor&quot; aria-hidden=&quot;true&quot; id=&quot;3-movement-of-people&quot;&gt;&lt;/a&gt;&lt;a href=&quot;#3-movement-of-people&quot; aria-hidden=&quot;true&quot; class=&quot;hash-link&quot;&gt;&lt;svg class=&quot;hash-link-icon&quot; aria-hidden=&quot;true&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. Movement of People&lt;/h1&gt;
"/><meta property="og:image" content="https://roiarthurb.github.io/BC2019-Gama-Site/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://roiarthurb.github.io/BC2019-Gama-Site/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/BC2019-Gama-Site/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://roiarthurb.github.io/BC2019-Gama-Site/blog/atom.xml" title="Test Site Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://roiarthurb.github.io/BC2019-Gama-Site/blog/feed.xml" title="Test Site Blog RSS Feed"/><link rel="stylesheet" href="/css/code-block-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-block-buttons.js"></script><link rel="stylesheet" href="/BC2019-Gama-Site/css/main.css"/><script src="/BC2019-Gama-Site/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/BC2019-Gama-Site/"><img class="logo" src="/BC2019-Gama-Site/img/favicon.ico" alt="Test Site"/><h2 class="headerTitleWithLogo">Test Site</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/BC2019-Gama-Site/docs/doc1" target="_self">Docs</a></li><li class=""><a href="/BC2019-Gama-Site/help" target="_self">Help</a></li><li class=""><a href="/BC2019-Gama-Site/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Tutorials/Tutorials/RoadTrafficModel/RoadTrafficModel_step3</h1></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="3-movement-of-people"></a><a href="#3-movement-of-people" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. Movement of People</h1>
<p>This third step presents how to create a road system from GIS data. More precisely, it shows how to build a graph from a list of polylines and to constrain the movement of an agent according to this graph.</p>
<h2><a class="anchor" aria-hidden="true" id="formulation"></a><a href="#formulation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Formulation</h2>
<ul>
<li>Definition of day_time global variable that will indicate, according to the simulation step, the time of the day: each simulation step will represent 10 minutes, then the day_time variable will be ranged between 0 and 144.</li>
<li>For each <strong>people</strong> agent: define a living_place(building of type 'Residential') and working place (building of type 'Industrial').</li>
<li>For each <strong>people</strong> agent: define start_work and end_work hours that respectively represent when the agent leaves its house to go to work and when it leaves its working_place to go back home. These hours will be randomly define between 36 (6 a.m;) and 60 (10 a.m.) for the start_work and 84 (2p.m.) and 132 (10p.m.) for the end_work.</li>
<li>For each <strong>people</strong> agent: define a objective variable: this one can 'go home' or 'working'.</li>
<li>For each <strong>people</strong> agent: define a speed. The speed will be randomly define between 50 and 100.</li>
<li>The <strong>people</strong> agents move along the road, taking the shortest path.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="model-definition"></a><a href="#model-definition" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Model Definition</h2>
<h3><a class="anchor" aria-hidden="true" id="people-agents"></a><a href="#people-agents" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>people agents</h3>
<p>First, we have to change the skill of the <strong>people</strong> agents: as we want to use an action of the <strong>moving</strong> skill (<strong>goto</strong>), we will provide the <strong>people</strong> agents with this skill. A <a href="AttachingSkills">skill</a> is a built-in module that provide the modeler a self-contain and relevant set of actions and variables.</p>
<pre><code class="hljs">   species people skills: [moving]{
       ...
   }
</code></pre>
<p>Then, we have to add new variables to the people agents: living_place, working_place, start_work, end_work, objective. In addition, we will add a &quot;the_target&quot; variable that will represents the point toward which the agent will be currently moving.</p>
<pre><code class="hljs">   species people skills: [moving]{
    rgb color &lt;- <span class="hljs-comment">#yellow ;</span>
    <span class="hljs-keyword">building </span>living_place &lt;- nil <span class="hljs-comment">;</span>
    <span class="hljs-keyword">building </span>working_place &lt;- nil <span class="hljs-comment">;</span>
    int start_work <span class="hljs-comment">;</span>
    int end_work  <span class="hljs-comment">;</span>
    string objective <span class="hljs-comment">; </span>
    point the_target &lt;- nil <span class="hljs-comment">;</span>
      
       ...
   }
</code></pre>
<p>We define two reflex methods that allow to change the objective (and the_target) of the agent at the start_work and en_work hours. Concerning the <em>target value</em>, we choose a random point in the objective building (working_place or living_place) by using the <strong>any_location_in</strong> operator.</p>
<pre><code class="hljs">   species people skills: [moving]{  
      ...
      reflex time_to_work when: current_hour = start_work <span class="hljs-keyword">and </span>objective = <span class="hljs-string">"resting"</span>{
           objective &lt;- <span class="hljs-string">"working"</span> <span class="hljs-comment">;</span>
       the_target &lt;- any_location_in (working_place)<span class="hljs-comment">;</span>
      }
        
      reflex time_to_go_home when: current_hour = end_work <span class="hljs-keyword">and </span>objective = <span class="hljs-string">"working"</span>{
       objective &lt;- <span class="hljs-string">"resting"</span> <span class="hljs-comment">;</span>
       the_target &lt;- any_location_in (living_place)<span class="hljs-comment">; </span>
      } 
      ...
  }
</code></pre>
<p>At last, we define a reflex method that allows the agent to move. If a target point is defined (the_target != nil), the agent moves in direction to its target using the <strong>goto</strong> action (provided by the moving skill). Note that we specified a graph to constraint the movement of the agents on the road network with the facet <strong>on</strong>. We will see later how this graph is built. The agent uses the shortest path (according to the graph) to go to the target point. When the agent arrives at destination (the_target = location), the target is set to nil (the agent will stop moving).</p>
<pre><code class="hljs">  species people skills: [moving]{
      ...
      reflex <span class="hljs-built_in">move</span> when: the_target != <span class="hljs-literal">nil</span> {
      <span class="hljs-keyword">do</span> <span class="hljs-built_in">goto</span> target: the_target on: the_graph ; 
      <span class="hljs-keyword">if</span> the_target = location {
        the_target &lt;- <span class="hljs-literal">nil</span> ;
      }
     }
  }
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="parameters"></a><a href="#parameters" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>parameters</h3>
<p>We add several parameters (<strong>min_work_start</strong>, <strong>max_work_start</strong>, <strong>min_work_end</strong>, <strong>max_work_end</strong>, <strong>min_speed</strong> and <strong>max_speed</strong>) and two global variables: <strong>the_graph</strong> (graph computed from the road network) and <strong>current_hour</strong> (current hour of the day). The value of the <strong>current_hour</strong> variable is automatically computed at each simulation step and is equals to &quot;(time(the simulation step <strong>step) / 1 hour) modulo 24&quot;.</strong></p>
<p>In the global section:</p>
<pre><code class="hljs">global {
        ...
        <span class="hljs-built_in">int</span> current_hour update: (time / #hour) mod <span class="hljs-number">24</span>;
    <span class="hljs-built_in">int</span> min_work_start &lt;- <span class="hljs-number">6</span>;
    <span class="hljs-built_in">int</span> max_work_start &lt;- <span class="hljs-number">8</span>;
    <span class="hljs-built_in">int</span> min_work_end &lt;- <span class="hljs-number">16</span>; 
    <span class="hljs-built_in">int</span> max_work_end &lt;- <span class="hljs-number">20</span>; 
    <span class="hljs-built_in">float</span> min_speed &lt;- <span class="hljs-number">1.0</span> #km / #h;
    <span class="hljs-built_in">float</span> max_speed &lt;- <span class="hljs-number">5.0</span> #km / #h; 
    graph the_graph;
        ...
}
</code></pre>
<p>In the experiment section:</p>
<pre><code class="hljs">experiment road_traffic <span class="hljs-keyword">type</span>: gui {
        <span class="hljs-params">...</span> 
    parameter <span class="hljs-string">"Earliest hour to start work"</span> <span class="hljs-built_in">var</span>: min_work_start category: <span class="hljs-string">"People"</span> <span class="hljs-keyword">min</span>: <span class="hljs-number">2</span> <span class="hljs-keyword">max</span>: <span class="hljs-number">8</span>;
    parameter <span class="hljs-string">"Latest hour to start work"</span> <span class="hljs-built_in">var</span>: max_work_start category: <span class="hljs-string">"People"</span> <span class="hljs-keyword">min</span>: <span class="hljs-number">8</span> <span class="hljs-keyword">max</span>: <span class="hljs-number">12</span>;
    parameter <span class="hljs-string">"Earliest hour to end work"</span> <span class="hljs-built_in">var</span>: min_work_end category: <span class="hljs-string">"People"</span> <span class="hljs-keyword">min</span>: <span class="hljs-number">12</span> <span class="hljs-keyword">max</span>: <span class="hljs-number">16</span>;
    parameter <span class="hljs-string">"Latest hour to end work"</span> <span class="hljs-built_in">var</span>: max_work_end category: <span class="hljs-string">"People"</span> <span class="hljs-keyword">min</span>: <span class="hljs-number">16</span> <span class="hljs-keyword">max</span>: <span class="hljs-number">23</span>;
    parameter <span class="hljs-string">"minimal speed"</span> <span class="hljs-built_in">var</span>: min_speed category: <span class="hljs-string">"People"</span> <span class="hljs-keyword">min</span>: <span class="hljs-number">0.1</span> #km/#h ;
    parameter <span class="hljs-string">"maximal speed"</span> <span class="hljs-built_in">var</span>: max_speed category: <span class="hljs-string">"People"</span> <span class="hljs-keyword">max</span>: <span class="hljs-number">10</span> #km/#h;
        <span class="hljs-params">...</span>
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="initialization"></a><a href="#initialization" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>initialization</h3>
<p>First, we need to compute from the <strong>road</strong> agents, a graph for the moving of the <strong>people</strong> agents. The operator <strong>as_edge_graph</strong> allows to do that. It automatically builds from a set of agents or geometries a graph where the agents are the edges of the graph, a node represent the extremities of the agent geometry.</p>
<pre><code class="hljs">   init {
      ...
      create road from: <span class="hljs-keyword">shape_file_roads </span><span class="hljs-comment">;</span>
      the_graph &lt;- as_edge_graph(road)<span class="hljs-comment">;</span>
      ...
   }
</code></pre>
<p>We randomly assign one working place and one house to each <strong>people</strong> agent. To simplify the GAML code, we define two temporary variables: the list of buildings of type 'Residential' and the list of buildings of type 'Industrial' (by using the <strong>where</strong> command). At the creation of each <strong>people</strong> agent, we define a speed, a start_work and end_work to each <strong>people</strong> agent (according to the min and max define in the parameters). We define as well an initial objective (&quot;resting&quot;). Concerning the definition of the living_place and working_place, these ones are randomly chosen in the residential_buildings and industrial_buildings lists.</p>
<pre><code class="hljs">   init {
      ...
      list&lt;building&gt; residential_buildings &lt;- building <span class="hljs-keyword">where</span> (each.<span class="hljs-class"><span class="hljs-keyword">type</span>="<span class="hljs-type">Residential</span>");</span>
      list&lt;building&gt;  industrial_buildings &lt;- building  <span class="hljs-keyword">where</span> (each.<span class="hljs-class"><span class="hljs-keyword">type</span>="<span class="hljs-type">Industrial</span>") ;</span>
      create people number: nb_people {
          speed &lt;- min_speed + rnd (max_speed - min_speed) ;
          start_work &lt;- min_work_start + rnd (max_work_start - min_work_start) ;
          end_work &lt;- min_work_end + rnd (max_work_end - min_work_end) ;
          living_place &lt;- one_of(residential_buildings) ;
          working_place &lt;- one_of(industrial_buildings) ;
          objective &lt;- <span class="hljs-string">"resting"</span>;
          location &lt;- any_location_in (living_place); 
      }
      ...
  }
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="complete-model"></a><a href="#complete-model" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Complete Model</h2>
<pre><code class="hljs">model tutorial_gis_city_traffic

global {
    file shape_file_buildings &lt;- file(<span class="hljs-string">"../includes/building.shp"</span>);
    file shape_file_roads &lt;- file(<span class="hljs-string">"../includes/road.shp"</span>);
    file shape_file_bounds &lt;- file(<span class="hljs-string">"../includes/bounds.shp"</span>);
    geometry shape &lt;- envelope(shape_file_bounds);
    <span class="hljs-built_in">float</span> step &lt;- <span class="hljs-number">10</span> <span class="hljs-comment">#mn;</span>
    <span class="hljs-built_in">int</span> nb_people &lt;- <span class="hljs-number">100</span>;
    <span class="hljs-built_in">int</span> current_hour update: (time / <span class="hljs-comment">#hour) mod 24;</span>
    <span class="hljs-built_in">int</span> min_work_start &lt;- <span class="hljs-number">6</span>;
    <span class="hljs-built_in">int</span> max_work_start &lt;- <span class="hljs-number">8</span>;
    <span class="hljs-built_in">int</span> min_work_end &lt;- <span class="hljs-number">16</span>; 
    <span class="hljs-built_in">int</span> max_work_end &lt;- <span class="hljs-number">20</span>; 
    <span class="hljs-built_in">float</span> min_speed &lt;- <span class="hljs-number">1</span>.<span class="hljs-number">0</span> <span class="hljs-comment">#km / #h;</span>
    <span class="hljs-built_in">float</span> max_speed &lt;- <span class="hljs-number">5</span>.<span class="hljs-number">0</span> <span class="hljs-comment">#km / #h; </span>
    graph the_graph;
    
    init {
        create building <span class="hljs-keyword">from</span>: shape_file_buildings <span class="hljs-keyword">with</span>: [<span class="hljs-keyword">type</span>::<span class="hljs-built_in">string</span>(read (<span class="hljs-string">"NATURE"</span>))] {
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">type</span>=<span class="hljs-string">"Industrial"</span> {
                color &lt;- <span class="hljs-comment">#blue ;</span>
            }
        }
        create road <span class="hljs-keyword">from</span>: shape_file_roads ;
        the_graph &lt;- as_edge_graph(road);
        
        list&lt;building&gt; residential_buildings &lt;- building where (each.<span class="hljs-keyword">type</span>=<span class="hljs-string">"Residential"</span>);
        list&lt;building&gt;  industrial_buildings &lt;- building  where (each.<span class="hljs-keyword">type</span>=<span class="hljs-string">"Industrial"</span>) ;
        create people number: nb_people {
            speed &lt;- min_speed + rnd (max_speed - min_speed) ;
            start_work &lt;- min_work_start + rnd (max_work_start - min_work_start) ;
            end_work &lt;- min_work_end + rnd (max_work_end - min_work_end) ;
            living_place &lt;- one_of(residential_buildings) ;
            working_place &lt;- one_of(industrial_buildings) ;
            objective &lt;- <span class="hljs-string">"resting"</span>;
            location &lt;- any_location_in (living_place); 
        }
    }
}

species building {
    <span class="hljs-built_in">string</span> <span class="hljs-keyword">type</span>; 
    rgb color &lt;- <span class="hljs-comment">#gray  ;</span>
    
    aspect base {
        draw shape color: color ;
    }
}

species road  {
    rgb color &lt;- <span class="hljs-comment">#black ;</span>
    aspect base {
        draw shape color: color ;
    }
}

species people skills:[moving] {
    rgb color &lt;- <span class="hljs-comment">#yellow ;</span>
    building living_place &lt;- <span class="hljs-keyword">nil</span> ;
    building working_place &lt;- <span class="hljs-keyword">nil</span> ;
    <span class="hljs-built_in">int</span> start_work ;
    <span class="hljs-built_in">int</span> end_work  ;
    <span class="hljs-built_in">string</span> objective ; 
    point the_target &lt;- <span class="hljs-keyword">nil</span> ;
        
    reflex time_to_work <span class="hljs-keyword">when</span>: current_hour = start_work <span class="hljs-keyword">and</span> objective = <span class="hljs-string">"resting"</span>{
        objective &lt;- <span class="hljs-string">"working"</span> ;
        the_target &lt;- any_location_in (working_place);
    }
        
    reflex time_to_go_home <span class="hljs-keyword">when</span>: current_hour = end_work <span class="hljs-keyword">and</span> objective = <span class="hljs-string">"working"</span>{
        objective &lt;- <span class="hljs-string">"resting"</span> ;
        the_target &lt;- any_location_in (living_place); 
    } 
     
    reflex move <span class="hljs-keyword">when</span>: the_target != <span class="hljs-keyword">nil</span> {
        <span class="hljs-keyword">do</span> goto target: the_target on: the_graph ; 
        <span class="hljs-keyword">if</span> the_target = location {
            the_target &lt;- <span class="hljs-keyword">nil</span> ;
        }
    }
    
    aspect base {
        draw circle(<span class="hljs-number">10</span>) color: color;
    }
}

experiment road_traffic <span class="hljs-keyword">type</span>: gui {
    parameter <span class="hljs-string">"Shapefile for the buildings:"</span> <span class="hljs-keyword">var</span>: shape_file_buildings category: <span class="hljs-string">"GIS"</span> ;
    parameter <span class="hljs-string">"Shapefile for the roads:"</span> <span class="hljs-keyword">var</span>: shape_file_roads category: <span class="hljs-string">"GIS"</span> ;
    parameter <span class="hljs-string">"Shapefile for the bounds:"</span> <span class="hljs-keyword">var</span>: shape_file_bounds category: <span class="hljs-string">"GIS"</span> ;
    parameter <span class="hljs-string">"Number of people agents"</span> <span class="hljs-keyword">var</span>: nb_people category: <span class="hljs-string">"People"</span> ;
    parameter <span class="hljs-string">"Earliest hour to start work"</span> <span class="hljs-keyword">var</span>: min_work_start category: <span class="hljs-string">"People"</span> min: <span class="hljs-number">2</span> max: <span class="hljs-number">8</span>;
    parameter <span class="hljs-string">"Latest hour to start work"</span> <span class="hljs-keyword">var</span>: max_work_start category: <span class="hljs-string">"People"</span> min: <span class="hljs-number">8</span> max: <span class="hljs-number">12</span>;
    parameter <span class="hljs-string">"Earliest hour to end work"</span> <span class="hljs-keyword">var</span>: min_work_end category: <span class="hljs-string">"People"</span> min: <span class="hljs-number">12</span> max: <span class="hljs-number">16</span>;
    parameter <span class="hljs-string">"Latest hour to end work"</span> <span class="hljs-keyword">var</span>: max_work_end category: <span class="hljs-string">"People"</span> min: <span class="hljs-number">16</span> max: <span class="hljs-number">23</span>;
    parameter <span class="hljs-string">"minimal speed"</span> <span class="hljs-keyword">var</span>: min_speed category: <span class="hljs-string">"People"</span> min: <span class="hljs-number">0</span>.<span class="hljs-number">1</span> <span class="hljs-comment">#km/#h ;</span>
    parameter <span class="hljs-string">"maximal speed"</span> <span class="hljs-keyword">var</span>: max_speed category: <span class="hljs-string">"People"</span> max: <span class="hljs-number">10</span> <span class="hljs-comment">#km/#h;</span>
    
    output {
        display city_display <span class="hljs-keyword">type</span>:opengl {
            species building aspect: base ;
            species road aspect: base ;
            species people aspect: base ;
        }
    }
}
</code></pre>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#formulation">Formulation</a></li><li><a href="#model-definition">Model Definition</a><ul class="toc-headings"><li><a href="#people-agents">people agents</a></li><li><a href="#parameters">parameters</a></li><li><a href="#initialization">initialization</a></li></ul></li><li><a href="#complete-model">Complete Model</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/BC2019-Gama-Site/" class="nav-home"><img src="/BC2019-Gama-Site/img/favicon.ico" alt="Test Site" width="66" height="58"/></a><div><h5>Docs</h5><a href="/BC2019-Gama-Site/docs/en/doc1.html">Getting Started (or other categories)</a><a href="/BC2019-Gama-Site/docs/en/doc2.html">Guides (or other categories)</a><a href="/BC2019-Gama-Site/docs/en/doc3.html">API Reference (or other categories)</a></div><div><h5>Community</h5><a href="/BC2019-Gama-Site/en/users.html">User Showcase</a><a href="http://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://discordapp.com/">Project Chat</a><a href="https://twitter.com/" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>More</h5><a href="/BC2019-Gama-Site/blog">Blog</a><a href="https://github.com/">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/BC2019-Gama-Site/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2019 GAMA-Platform</section></footer></div></body></html>